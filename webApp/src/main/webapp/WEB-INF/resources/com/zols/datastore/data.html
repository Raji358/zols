<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Dynamic Form</title>
    </head>
    <body th:fragment="content">
        <form id="dynamicForm" th:name="${entity.name}"></form>   
        <button id="submit" type="submit">Submit</button>
        <button id="cancel" type="button">Cancel</button>

        <div id="jsonData" style="float:left; width:50%;"></div>
        <script type="text/javascript" src="../../../../../../webapp/resources/js/jquery-1.10.2.min.js" th:src="@{/resources/js/jquery-1.10.2.min.js}"></script>
        <script type="text/javascript" src="../../../../../../webapp/resources/js/jquery-te-1.4.0.min.js" th:src="@{/resources/js/jquery-te-1.4.0.min.js}"></script>
        <script type="text/javascript" src="../../../../../../webapp/resources/js/handlebars.js" th:src="@{/resources/js/handlebars.js}"></script>
        <script type="text/javascript" src="../../../../../../webapp/resources/js/form2js.js" th:src="@{/resources/js/form2js.js}"></script>
        <script type="text/javascript" src="../../../../../../webapp/resources/js/jquery.toObject.js" th:src="@{/resources/js/jquery.toObject.js}"></script>
        <script type="text/javascript" src="../../../../../../webapp/resources/js/makeform.js" th:src="@{/resources/js/makeform/makeform.js}"></script>        
        <script type="text/javascript" src="../../../../../../webapp/resources/js/prettyprint.js" th:src="@{/resources/js/prettyprint.js}"></script>
        <script type="text/javascript">
            
            String.prototype.replaceAt = function(i, char) {
                return this.substr(0, i) + char + this.substr(i);
            };

            $(document).ready(function() {
                
                var pathname = window.location.pathname;
                var method = window.location.pathname;
                var listing_pathname;
                if (pathname.indexOf("/add") !== -1) {
                    listing_pathname = pathname.substr(0, pathname.lastIndexOf('/add'));
                    pathname = '../../api/data/'+$("#dynamicForm").attr('name');
                    method = 'POST';
                }
                else {
                    listing_pathname = pathname.substr(0, pathname.lastIndexOf('/'));
                    pathname = pathname.replaceAt(pathname.substr(0, pathname.lastIndexOf('/')).lastIndexOf('/'), '/api');
                    method = 'PUT';
                }
                
                function onRender() {

                }

                $("#dynamicForm").makeform("../../api/entities/{{name}}", "simple", "../../resources/js/makeform/theme", onRender);


                $('#cancel').click(function() {
                    window.location.href = listing_pathname;
                });

                $("#submit").click(function() { 
                    $.ajax(
                            {
                                url: pathname,
                                type: method,
                                data: JSON.stringify($("#dynamicForm").toObject({mode: 'first'})),
                                dataType: "json",
                                contentType: 'application/json',
                                success: function(data, textStatus, jqXHR)
                                {
                                    window.location.href = listing_pathname;
                                },
                                error: function(jqXHR, textStatus, errorThrown)
                                {
                                    console.log(jqXHR + "===" + textStatus);
                                }
                            });                    
                });

                function printJSON() {
                    
                }
            });
        </script>

    </body>
</html>
