<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8"/>
        <title>List entities</title>       
        <link rel="stylesheet" type="text/css" media="screen" href="../../../../webApp/src/main/webapp/resourcescss/redmond/jquery-ui-1.10.3.custom.min.css" th:href="@{/resources/css/redmond/jquery-ui-1.10.3.custom.min.css}"/>
        <link rel="stylesheet" type="text/css" media="screen" href="../../../../webApp/src/main/webapp/resourcescss/ui.jqgrid.css" th:href="@{/resources/css/ui.jqgrid.css}"/>
        <link rel="stylesheet" type="text/css" media="screen" href="../../../../webApp/src/main/webapp/resourcescss/jquery.idealforms.min.css" th:href="@{/resources/css/jquery.idealforms.min.css}"/>
    </head>
    <body>
        <div class="link">
            <div class="categoryContainer">
                <select name ="linkCategory" id ="link_category"></select>
                <button id="addCategoryBtn">+</button>
            </div>
            <div class="linkContainer">
                <ul id="childLink">

                </ul>

            </div>
        </div>
        <script src="../../../../webApp/src/main/webapp/resourcesjs/jquery-1.10.2.min.js" th:src="@{/resources/js/jquery-1.10.2.min.js}"></script>
        <script src="../../../../webApp/src/main/webapp/resourcesjs/jquery-ui-1.10.3.custom.min.js" th:src="@{/resources/js/jquery-ui-1.10.3.custom.min.js}"></script>
        <script src="../../../../webApp/src/main/webapp/resourcesjs/i18n/grid.locale-en.js" th:src="@{/resources/js/i18n/grid.locale-en.js}"></script>
        <script src="../../../../webApp/src/main/webapp/resourcesjs/jquery.jqGrid.min.js" th:src="@{/resources/js/jquery.jqGrid.min.js}"></script>
        <script src="../../../../webApp/src/main/webapp/resources/js/handlebars.js" th:src="@{/resources/js/handlebars.js}"></script>
        <script src="../../../../webApp/src/main/webapp/resources/js/jquery-handlebar.js" th:src="@{/resources/js/jquery-handlebar.js}"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                URL = 'http://localhost:8080/zols';
                console.log(URL + '/api/categories');
                $.ajax({
                    url: URL + '/api/categories',
                    type: 'GET',
                    dataType: "json",
                    contentType: 'application/json',
                    success: function(data, textStatus, jqXHR)
                    {


                        var categoryOption = '<option>Select </option>';
                        $.each(data.content, function(key, value) {
                            console.log(value.name);
                            categoryOption += "<option value=" + value.name + " >" + value.label + "</option>";
                        });
                        $("#link_category").append(categoryOption);

                        $("#link_category").change(function() {
                            categoryName = $("#link_category").val();
                            getCategoryLinks(categoryName);
                        });
                    },
                    error: function(jqXHR, textStatus, errorThrown)
                    {
                        return false;
                        console.log(jqXHR + "===" + textStatus);
                    }
                });
            });
            function getCategoryLinks(category) {
                console.log(URL + '/api/links/category/' + category);
                $.ajax({
                    url: URL + '/api/links/category/' + category,
                    type: 'GET',
                    dataType: "json",
                    contentType: 'application/json',
                    success: function(data, textStatus, jqXHR)
                    {
                        $("#childLink").empty();
                        var childData = "";
                        if (data.length > 0) {
                            $("#childLink").handlebars('childList', data);

                            $("#childLink li").click(function() {
                                onClickLink($(this).attr("id"));
                            });

                        } else {
                            childData = childData + "<li> No Record!</li>";
                            $("#childLink").html(childData);
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown)
                    {
                        console.log(jqXHR + "===" + textStatus);
                    }
                });
            }

            $("#my-form").submit(function(e)
            {
                console.log(JSON.stringify($("#my-form").toObject({mode: 'first'})));

                console.log(categoryName);


            });

            $('#addCategoryBtn').click(function() {
                console.log(URL);
                window.location = URL + '/links/add/' + categoryName;
            });

            function onClickLink(id) {
                console.log(id);
            }
        </script>
        <script id="childList" type="text/x-handlebars-template">
            {{#each this}}
            <li id="{{name}}" class="link">{{label}}<a href="javascript:void(0)">+</a><a href="javascript:void(0)">-</a></li>
            {{/each}}

        </script>
    </body>
</html>